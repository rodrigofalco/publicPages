<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Platform Architecture</title>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Lato:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Lato', 'Montserrat', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #046cfc 0%, #15294b 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 30px;
            width: 100%;
            min-width: 800px;
            box-sizing: border-box;
        }

        h1 {
            color: #15294b;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2em;
            font-weight: 700;
            font-family: 'Montserrat', sans-serif;
        }

        .brand-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .brand-logo {
            margin-bottom: 10px;
        }

        .brand-logo img {
            height: 40px;
            width: auto;
        }

        .brand-tagline {
            font-size: 0.9em;
            color: #666;
            font-weight: 400;
        }

        .brand-accent {
            color: #f1870d;
        }

        #diagram-container {
            display: flex;
            justify-content: center;
            overflow: hidden;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 600px;
            width: 100%;
        }

        .mermaid {
            text-align: center;
            width: 100%;
            height: 100%;
        }

        .mermaid svg {
            width: 100%;
            height: 100%;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: white;
            font-size: 0.9em;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #666;
        }

        .controls {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
            z-index: 10;
        }

        .control-btn {
            background: white;
            border: 2px solid #046cfc;
            border-radius: 4px;
            padding: 8px 16px;
            cursor: pointer;
            font-size: 14px;
            color: #046cfc;
            font-weight: 600;
            font-family: 'Montserrat', sans-serif;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: #046cfc;
            color: white;
        }

        .hint {
            text-align: center;
            margin-top: 10px;
            color: #666;
            font-size: 0.85em;
        }

        @media (max-width: 820px) {
            body {
                padding: 10px;
            }

            .container {
                padding: 20px;
                min-width: 100%;
            }

            h1 {
                font-size: 1.5em;
            }

            #diagram-container {
                min-height: 400px;
            }
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            securityLevel: 'loose'
        });

        window.addEventListener('DOMContentLoaded', () => {
            setTimeout(() => {
                document.getElementById('loading').style.display = 'none';
                initZoomAndPan();
            }, 1000);
        });

        function initZoomAndPan() {
            const svg = document.querySelector('.mermaid svg');
            if (!svg) return;

            let scale = 1;
            let translateX = 0;
            let translateY = 0;
            let isDragging = false;
            let startX, startY;

            // Add cursor style
            svg.style.cursor = 'grab';

            // Zoom with mouse wheel centered on cursor
            svg.addEventListener('wheel', (e) => {
                e.preventDefault();

                const rect = svg.getBoundingClientRect();
                const mouseX = e.clientX - rect.left;
                const mouseY = e.clientY - rect.top;

                // Mouse position relative to current transform
                const worldX = (mouseX - translateX) / scale;
                const worldY = (mouseY - translateY) / scale;

                const delta = e.deltaY > 0 ? 0.9 : 1.1;
                const newScale = Math.max(0.1, Math.min(scale * delta, 5));

                // Adjust translation to keep mouse point stationary
                translateX = mouseX - worldX * newScale;
                translateY = mouseY - worldY * newScale;
                scale = newScale;

                updateTransform();
            });

            // Pan with mouse drag
            svg.addEventListener('mousedown', (e) => {
                isDragging = true;
                startX = e.clientX - translateX;
                startY = e.clientY - translateY;
                svg.style.cursor = 'grabbing';
            });

            svg.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                translateX = e.clientX - startX;
                translateY = e.clientY - startY;
                updateTransform();
            });

            svg.addEventListener('mouseup', () => {
                isDragging = false;
                svg.style.cursor = 'grab';
            });

            svg.addEventListener('mouseleave', () => {
                isDragging = false;
                svg.style.cursor = 'grab';
            });

            // Touch support for mobile
            let touchStartX, touchStartY;
            svg.addEventListener('touchstart', (e) => {
                if (e.touches.length === 1) {
                    touchStartX = e.touches[0].clientX - translateX;
                    touchStartY = e.touches[0].clientY - translateY;
                }
            });

            svg.addEventListener('touchmove', (e) => {
                e.preventDefault();
                if (e.touches.length === 1) {
                    translateX = e.touches[0].clientX - touchStartX;
                    translateY = e.touches[0].clientY - touchStartY;
                    updateTransform();
                }
            });

            function updateTransform() {
                const g = svg.querySelector('g');
                if (g) {
                    g.style.transform = `translate(${translateX}px, ${translateY}px) scale(${scale})`;
                    g.style.transformOrigin = '0 0';
                }
            }

            // Reset button functionality
            window.resetZoom = () => {
                scale = 1;
                translateX = 0;
                translateY = 0;
                updateTransform();
            };
        }
    </script>
</head>
<body>
    <div class="container">
        <div class="brand-header">
            <div class="brand-logo">
                <a href="https://patagonian.com" target="_blank">
                    <img src="patagonian_logo_RGB_color-300x58.png" alt="Patagonian">
                </a>
            </div>
            <div class="brand-tagline">Innovative digital solutions <span class="brand-accent">(AI, IoT, Data & more)</span></div>
        </div>
        <h1>üèóÔ∏è AI Platform Architecture</h1>
        <div class="controls">
            <button class="control-btn" onclick="resetZoom()">Reset Zoom</button>
        </div>
        <div id="diagram-container">
            <div class="loading" id="loading">Loading diagram...</div>
            <div class="mermaid">
flowchart TB
    subgraph Usuario[User Layer]
        U[User]
    end

    subgraph Auth[Authentication Layer]
        AUTH[Auth & AuthZ<br/>Entra ID / OAuth 2.0]
    end

    subgraph Interface[Interface Layer]
        IC[Chat Interface<br/>Web/Mobile/Desktop]
    end

    subgraph Backend[Backend Layer]
        BE[Backend API<br/>Node.js/Python/Java]
        SCH[Scheduler<br/>Cron Jobs/Celery]
    end

    subgraph Docs[Document Repository]
        DMS[Document Repository<br/>Google Drive/SharePoint]
    end

    subgraph IA[AI Layer]
        LLM[LLM<br/>Claude Sonnet/GPT-4]
    end

    subgraph Automatizacion[Automation Layer]
        AUTO[Automation Platform<br/>Power Automate/n8n]
    end

    subgraph MCP_Layer[MCP Layer]
        MCP[Model Context Protocol]
        MCP1[MCP Tool 1<br/>Database Connector]
        MCP2[MCP Tool 2<br/>API Gateway]
        MCP3[MCP Tool 3<br/>Documents Connector]
    end

    subgraph Integraciones[Integrations Layer]
        API[Internal APIs<br/>REST/GraphQL]
        ERP[ERP/CRM<br/>SAP/Salesforce]
    end

    subgraph Datos[Data Layer]
        DB[(Databases<br/>SQL/NoSQL)]
        FILES[Storage<br/>S3/Local Storage]
    end

    subgraph Observabilidad[Observability Layer]
        OBS[Monitoring<br/>Langfuse/Grafana]
    end

    U --> IC
    IC --> AUTH
    IC --> BE
    BE --> AUTH
    SCH --> BE
    BE --> DMS
    BE --> LLM
    BE --> AUTO
    AUTO --> LLM
    AUTO --> MCP
    AUTO --> BE
    LLM --> MCP
    MCP --> MCP1
    MCP --> MCP2
    MCP --> MCP3
    MCP1 --> DB
    MCP1 --> FILES
    MCP2 --> API
    MCP2 --> ERP
    MCP3 --> DMS
    BE -.-> OBS
    LLM -.-> OBS
    AUTO -.-> OBS
    MCP -.-> OBS
    DMS -.-> FILES
    DMS -.-> DB
    IC -.-> U

    style U fill:#e1f5ff
    style AUTH fill:#ffe1f0
    style IC fill:#fff4e1
    style BE fill:#ffd6e8
    style SCH fill:#ffb3d9
    style DMS fill:#ffe8b3
    style LLM fill:#f0e1ff
    style AUTO fill:#e8d4ff
    style MCP fill:#e1ffe1
    style MCP1 fill:#c8f7c8
    style MCP2 fill:#c8f7c8
    style MCP3 fill:#c8f7c8
    style DB fill:#ffe1e1
    style API fill:#ffe1e1
    style FILES fill:#ffe1e1
    style ERP fill:#ffe1e1
    style OBS fill:#d4f1f4
            </div>
            <div class="hint">üí° Use mouse wheel to zoom, drag to pan</div>
        </div>
    </div>
    <div class="footer">
        <p>¬© Patagonian | <a href="https://patagonian.com" target="_blank" style="color: white; text-decoration: underline;">patagonian.com</a></p>
    </div>
</body>
</html>